set timeout=10
set default=0
insmod all_video
insmod gfxterm
insmod png
insmod vbe
insmod vga
set gfxmode=1280x1024,1024x768,auto
set gfxpayload=keep
terminal_output gfxterm
if background_image /boot/grub/nextOS2.png ; then true ; fi

menuentry "NextOS" {
    # noapic: skip IO-APIC (disable it in VirtualBox settings too)
    # lapic:  use Local APIC timer — safe, VirtualBox handles this fine
    # NEVER use nolapic — it disables the LAPIC entirely and crashes VirtualBox host
    linux  /boot/vmlinuz \
        root=/dev/ram0 rw quiet \
        nextos.rootfs=/boot/rootfs.img \
        noapic lapic \
        video=1280x1024 \
        fbcon=scrollback:512
    initrd /boot/initramfs.img
}

menuentry "NextOS (Verbose)" {
    linux  /boot/vmlinuz \
        root=/dev/ram0 rw \
        nextos.rootfs=/boot/rootfs.img \
        noapic lapic \
        video=1280x1024 \
        fbcon=scrollback:512
    initrd /boot/initramfs.img
}

menuentry "NextOS (Minimal — no framebuffer)" {
    # Safest possible boot: text mode, no APIC tricks beyond noapic
    linux  /boot/vmlinuz \
        root=/dev/ram0 rw \
        nextos.rootfs=/boot/rootfs.img \
        noapic lapic \
        nomodeset
    initrd /boot/initramfs.img
}