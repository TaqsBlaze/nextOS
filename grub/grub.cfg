set timeout=10
set default=0
insmod all_video
insmod gfxterm
insmod png
insmod vbe
insmod vga
# FIX: gfxpayload=keep passes the framebuffer mode into the kernel.
# Without this the kernel switches back to 80x25 text mode on boot.
set gfxmode=1280x1024,1024x768,auto
set gfxpayload=keep
terminal_output gfxterm
if background_image /boot/grub/nextOS2.png ; then true ; fi

menuentry "NextOS" {
    # noapic  — disables IO-APIC; fixes VirtualBox timer panic
    # lapic   — forces use of Local APIC timer (VirtualBox emulates this correctly)
    # video=  — sets kernel framebuffer resolution (matches gfxmode above)
    linux  /boot/vmlinuz \
        root=/dev/ram0 rw quiet \
        nextos.rootfs=/boot/rootfs.img \
        noapic lapic \
        video=1280x1024 \
        fbcon=scrollback:512
    initrd /boot/initramfs.img
}

menuentry "NextOS (Verbose)" {
    linux  /boot/vmlinuz \
        root=/dev/ram0 rw \
        nextos.rootfs=/boot/rootfs.img \
        noapic lapic \
        video=1280x1024 \
        fbcon=scrollback:512
    initrd /boot/initramfs.img
}

menuentry "NextOS (Safe — 1024x768, no APIC)" {
    linux  /boot/vmlinuz \
        root=/dev/ram0 rw \
        nextos.rootfs=/boot/rootfs.img \
        noapic nolapic \
        video=1024x768 \
        fbcon=scrollback:512
    initrd /boot/initramfs.img
}