# =============================================================
#  NextOS GRUB2 Boot Configuration
#  Place at: iso/boot/grub/grub.cfg
# =============================================================

# ── Timing ────────────────────────────────────────────────────
set timeout=10
set default=0

# ── Graphics stack ────────────────────────────────────────────
# Load video and terminal modules before anything visual
insmod all_video
insmod video_bochs
insmod video_cirrus
insmod gfxterm
insmod gfxterm_background
insmod png
insmod jpeg
insmod font

# Switch terminal to graphical output
if loadfont /boot/grub/fonts/unicode.pf2 ; then
    set gfxmode=1024x768,800x600,auto
    terminal_output gfxterm
fi

# ── Background image ─────────────────────────────────────────
# nexOS2.png must be copied into iso/boot/grub/ at build time
if background_image /boot/grub/nexOS2.png ; then
    set color_normal=white/black
    set color_highlight=black/white
else
    # Fallback: dark background via theme or color
    set color_normal=cyan/black
    set color_highlight=black/cyan
fi

# ── Theme ─────────────────────────────────────────────────────
# Full theme (overrides background_image settings above if present)
if [ -f /boot/grub/themes/nextOS/theme.txt ] ; then
    set theme=/boot/grub/themes/nextOS/theme.txt
fi

# ── Helper: set graphics mode per entry ──────────────────────
# (Resets gfxpayload so kernel gets a clean framebuffer)

# ── Menu entries ─────────────────────────────────────────────

menuentry "NextOS" --class nextOS --class gnu-linux --class os {
    set gfxpayload=keep
    linux  /boot/vmlinuz root=/dev/ram0 rw quiet splash \
           nextOS.rootfs=/boot/rootfs.img \
           console=tty1 loglevel=3
    initrd /boot/initramfs.img
}

menuentry "NextOS (Verbose)" --class nextOS --class gnu-linux {
    set gfxpayload=keep
    linux  /boot/vmlinuz root=/dev/ram0 rw \
           nextOS.rootfs=/boot/rootfs.img \
           console=tty1 loglevel=7
    initrd /boot/initramfs.img
}

menuentry "NextOS (Recovery Shell)" --class nextOS {
    set gfxpayload=text
    linux  /boot/vmlinuz root=/dev/ram0 rw \
           nextOS.rootfs=/boot/rootfs.img \
           console=tty1 loglevel=7 init=/bin/sh
    initrd /boot/initramfs.img
}

menuentry "Reboot" --class restart {
    reboot
}

menuentry "Power Off" --class halt {
    halt
}
